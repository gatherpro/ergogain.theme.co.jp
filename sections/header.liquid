{% comment %}
  Apple-Style Header Section
  - Minimal design with transparent-to-solid transition on scroll
  - Desktop: Logo (left), Nav (center), Search + Icons (right)
  - Mobile: Logo + hamburger menu + icons
{% endcomment %}

<link rel="stylesheet" href="{{ 'component-list-menu.css' | asset_url }}" media="print" onload="this.media='all'">
<link rel="stylesheet" href="{{ 'component-menu-drawer.css' | asset_url }}" media="print" onload="this.media='all'">
<link rel="stylesheet" href="{{ 'apple-header.css' | asset_url }}" media="print" onload="this.media='all'">

<script src="{{ 'apple-header.js' | asset_url }}" defer="defer"></script>

{%- style -%}
  :root {
    --apple-header-bg: {{ section.settings.header_bg_color }};
    --apple-header-text: {{ section.settings.header_text_color }};
    --apple-header-hover: {{ section.settings.header_hover_color }};
    --apple-header-font-size: {{ section.settings.font_size }}px;
    --apple-header-line-height: {{ section.settings.line_height }};
    --apple-header-padding-x: {{ section.settings.padding_horizontal }}px;
    --apple-header-padding-y: {{ section.settings.padding_vertical }}px;
    --apple-header-menu-gap: {{ section.settings.menu_gap }}px;
    --apple-header-height: {{ section.settings.header_height }}px;
  }
{%- endstyle -%}

{% liquid
  assign sticky_class = ''
  if section.settings.enable_sticky
    assign sticky_class = 'apple-header--sticky'
  endif
%}

<header class="apple-header {{ sticky_class }}" data-header>
  <div class="apple-header__container page-width">

    {%- comment -%} Mobile Hamburger (left on mobile) {%- endcomment -%}
    <button
      class="apple-header__hamburger"
      aria-label="Open menu"
      aria-expanded="false"
      aria-controls="mobile-menu-drawer"
      data-mobile-menu-toggle
    >
      <svg aria-hidden="true" width="20" height="14" viewBox="0 0 20 14" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M1 1H19M1 7H19M1 13H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>

    {%- comment -%} Logo {%- endcomment -%}
    <div class="apple-header__logo">
      {%- if request.page_type == 'index' -%}<h1 class="apple-header__logo-heading">{%- endif -%}
        <a href="{{ routes.root_url }}" class="apple-header__logo-link">
          {%- if settings.logo != blank -%}
            {%- assign logo_alt = settings.logo.alt | default: shop.name | escape -%}
            {%- assign logo_height = settings.logo_width | divided_by: settings.logo.aspect_ratio -%}
            {{ settings.logo | image_url: width: 300 | image_tag:
              class: 'apple-header__logo-img',
              alt: logo_alt,
              width: settings.logo_width,
              height: logo_height,
              loading: 'eager'
            }}
          {%- else -%}
            <span class="apple-header__logo-text">{{ shop.name }}</span>
          {%- endif -%}
        </a>
      {%- if request.page_type == 'index' -%}</h1>{%- endif -%}
    </div>

    {%- comment -%} Desktop Navigation (center) {%- endcomment -%}
    <nav class="apple-header__nav" aria-label="Primary navigation">
      {%- if section.settings.menu != blank -%}
        <ul class="apple-header__menu">
          {%- for link in linklists[section.settings.menu].links -%}
            <li class="apple-header__menu-item">
              <a
                href="{{ link.url }}"
                class="apple-header__menu-link"
                {% if link.current %}aria-current="page"{% endif %}
              >
                {{ link.title }}
              </a>
            </li>
          {%- endfor -%}
        </ul>
      {%- endif -%}
    </nav>

    {%- comment -%} Right Icons (Search, Account, Cart) {%- endcomment -%}
    <div class="apple-header__icons">

      {%- comment -%} Search Icon {%- endcomment -%}
      <button
        class="apple-header__icon"
        aria-label="Open search"
        data-search-toggle
      >
        <svg aria-hidden="true" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="9" cy="9" r="7" stroke="currentColor" stroke-width="2"/>
          <path d="M14 14L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>

      {%- comment -%} Account Icon {%- endcomment -%}
      {%- if shop.customer_accounts_enabled -%}
        <a
          href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}"
          class="apple-header__icon"
          aria-label="Account"
        >
          <svg aria-hidden="true" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="10" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
            <path d="M3 18C3 14.134 6.13401 11 10 11C13.866 11 17 14.134 17 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </a>
      {%- endif -%}

      {%- comment -%} Cart Icon with Badge {%- endcomment -%}
      <a
        href="{{ routes.cart_url }}"
        class="apple-header__icon apple-header__cart"
        aria-label="Cart {% if cart.item_count > 0 %}({{ cart.item_count }} items){% endif %}"
      >
        <svg aria-hidden="true" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 3H4.5L6.5 14H16L18 6H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="8" cy="17" r="1" fill="currentColor"/>
          <circle cx="15" cy="17" r="1" fill="currentColor"/>
        </svg>
        {%- if cart.item_count > 0 -%}
          <span class="apple-header__cart-badge" aria-hidden="true">{{ cart.item_count }}</span>
        {%- endif -%}
      </a>
    </div>
  </div>

  {%- comment -%} Search Modal {%- endcomment -%}
  <div class="apple-header__search-modal" data-search-modal hidden>
    <div class="apple-header__search-container">
      <form action="{{ routes.search_url }}" method="get" role="search" class="apple-header__search-form">
        <input
          type="search"
          name="q"
          class="apple-header__search-input"
          placeholder="{{ section.settings.search_placeholder }}"
          aria-label="Search"
          autocomplete="off"
          data-search-input
        >
        <button type="button" class="apple-header__search-close" aria-label="Close search" data-search-close>
          <svg aria-hidden="true" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </form>
    </div>
  </div>
</header>

{%- comment -%} Mobile Menu Drawer {%- endcomment -%}
<div class="apple-header__mobile-drawer" data-mobile-menu hidden>
  <div class="apple-header__mobile-drawer-content">
    <div class="apple-header__mobile-drawer-header">
      <button
        class="apple-header__mobile-drawer-close"
        aria-label="Close menu"
        data-mobile-menu-close
      >
        <svg aria-hidden="true" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    {%- if section.settings.menu != blank -%}
      <nav class="apple-header__mobile-nav" aria-label="Mobile navigation">
        <ul class="apple-header__mobile-menu">
          {%- for link in linklists[section.settings.menu].links -%}
            <li class="apple-header__mobile-menu-item">
              <a
                href="{{ link.url }}"
                class="apple-header__mobile-menu-link"
                {% if link.current %}aria-current="page"{% endif %}
              >
                {{ link.title }}
              </a>
            </li>
          {%- endfor -%}
        </ul>
      </nav>
    {%- endif -%}
  </div>
  <div class="apple-header__mobile-drawer-overlay" data-mobile-menu-overlay></div>
</div>

{% schema %}
{
  "name": "Apple Header",
  "class": "apple-header-section",
  "settings": [
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Menu"
    },
    {
      "type": "text",
      "id": "search_placeholder",
      "default": "Search...",
      "label": "Search placeholder text"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky",
      "default": true,
      "label": "Enable sticky header"
    },
    {
      "type": "range",
      "id": "header_height",
      "min": 44,
      "max": 80,
      "step": 2,
      "unit": "px",
      "default": 56,
      "label": "Header height"
    },
    {
      "type": "range",
      "id": "padding_horizontal",
      "min": 8,
      "max": 48,
      "step": 4,
      "unit": "px",
      "default": 20,
      "label": "Horizontal padding"
    },
    {
      "type": "range",
      "id": "padding_vertical",
      "min": 8,
      "max": 32,
      "step": 2,
      "unit": "px",
      "default": 12,
      "label": "Vertical padding"
    },
    {
      "type": "range",
      "id": "menu_gap",
      "min": 12,
      "max": 48,
      "step": 4,
      "unit": "px",
      "default": 32,
      "label": "Menu item spacing"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "font_size",
      "min": 12,
      "max": 18,
      "step": 1,
      "unit": "px",
      "default": 14,
      "label": "Font size"
    },
    {
      "type": "range",
      "id": "line_height",
      "min": 1.2,
      "max": 2.0,
      "step": 0.1,
      "default": 1.5,
      "label": "Line height"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "header_bg_color",
      "default": "#ffffff",
      "label": "Background color"
    },
    {
      "type": "color",
      "id": "header_text_color",
      "default": "#1d1d1f",
      "label": "Text color"
    },
    {
      "type": "color",
      "id": "header_hover_color",
      "default": "#0066cc",
      "label": "Hover color"
    }
  ]
}
{% endschema %}
